//- create by afterloe on 2017-2-14 14:58:37 - MIT

include header

- const _systemNotice = locals.systemNotice || {};
- const _systemAnnouncement = locals.systemAnnouncement || [];
- const _subscribe = locals.subscribe || [];
- const _discuss = locals.discuss || [];
- const _user = locals.user;
- const _systemAnnouncementNum = locals.systemAnnouncementNum || 0;
- const _discussCount = locals.discussCount || 0;

link(href= static + "css/portal/mask.css?time=" + __time rel="stylesheet")
link(href= static + "css/portal/home.css?time=" + __time rel="stylesheet")

if _systemNotice.content
  div(class="alert alert-danger" role="alert")
    strong=_systemNotice.content

div(class="popup")
  div(class="mask")
    div(class="box")
      header
        span(class="name") 建议反馈
        span(class="btn_close")
      form(action="" class="form")
        div(class="description")
          textarea(class="feedbackContent form-control" rows="3")
        div(class="last")
          span 联系方式:
          span
            input(type="text" placeholder="您的联系方式" value=_user ? _user.mail:null)
          span
            div(class="submit_re" style="cursor:pointer;") 提交

div(class="container content")
  div(class="container structure")
    span(class="portalWhete")

    div(class=_subscribe.length === 0 ? "mainBox noHelp":"mainBox")
      div(class="catalogShadow")
        span(class="badge number")=_systemAnnouncementNum
        div(class="title")
          span(class="name") 公告
          span(class="downButton down")
      ul(class="data")
        each announcement in _systemAnnouncement
          li
            div
              i
              span(class="content" data-href=announcement.href)=announcement.title
              span(class="time")=new Date(announcement.createTimestamp).toLocaleString()

    //-
      div(class="catalogShadow")
        span(class="badge number")=_discussCount
        div(class="title")
          span(class="name" onClick="javascript:openDiscuss();") 热点讨论
          span(class="downButton down")
      ul(class="data")
        each discus in _discuss
          li
            div
              i
              span(class="content" data-href=discus.href)=discus.title
              span(class="time")=new Date(discus.createTimestamp).toLocaleString()

    div(class="helpBox" style=_subscribe.length === 0 ? "width:0;":"")
      each subscribe in _subscribe
        div(class="catalogShadow")
          span(class="badge number")=subscribe.items.length
          div(class="title")
            span=subscribe.title
            span(class="downButton up")
        ul(class="data")
          each subscribeItem in subscribe.items
            li
              div
                i
                span(class="content" data-href=subscribeItem.href)=subscribeItem.title
                span(class="time")=new Date(subscribeItem.createTimestamp).toLocaleString()
    div(class="feedback")

include footer

script(src= static + "js/portal/rem.js?time=" + __time)
script(src= static + "js/portal/bin/home.js?time=" + __time)
